<html>
  <head>
    <meta charset="utf-8">
    <title>Virtual Classroom </title>
    <meta name="viewport" content="width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    <script src="../easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <a-scene networked-scene="
      app: myApp;
      room: room1;
      debug: true;
      adapter: easyrtc;
      audio: true;
     "
     fog="type: linear; color: #FFA500; far: 30; near: 0" animation__fog="property: fog.color; to: #6EBAA7; dur:10000"
     >
      <a-sky color="#6EBAA7"></a-sky>
      <a-gltf-model src="../GearboxAssy.gltf" scale="0.1 0.1 0.1" position="-15 0 -2"></a-gltf-model>
      <a-plane src="#ground" height="100" width="100" rotation="-90 0 0" color="#8B4513"></a-plane>
     <template id="avatar-template">
        <a-entity class="avatar">
        </a-entity>
      </template>

      <a-assets>
        <audio src="https://cdn.aframe.io/basic-guide/audio/backgroundnoise.wav" autoplay preload>
        </audio>
        <a-asset-item id="co2" src="../img/co2.glb"></a-asset-item>
        <a-asset-item id="h2o" src="../img/h2o.glb"></a-asset-item>
        <a-asset-item id="solid" src="../img/solid.glb"></a-asset-item>
        <a-asset-item id="tree1" src="../img/tree1.glb"></a-asset-item>
        <a-asset-item id="tree2" src="../img/tree2.glb"></a-asset-item>
        <a-asset-item id="tree3" src="../img/tree3.glb"></a-asset-item>
        <a-asset-item id="tree4" src="../img/tree4.glb"></a-asset-item>
        <a-asset-item id="tree5" src="../img/tree5.glb"></a-asset-item>
        <a-asset-item id="tree6" src="../img/tree6.glb"></a-asset-item>
        <a-asset-item id="tree7" src="../img/tree7.glb"></a-asset-item>
        <a-asset-item id="tree8" src="../img/tree8.glb"></a-asset-item>
        <a-asset-item id="tree9" src="../img/tree9.glb"></a-asset-item>
        <a-asset-item id="tree10" src="../img/tree10.glb"></a-asset-item>
        <video id="v" autoplay loop="false" webkit-playsinline playsinline src="../img/s.mp4"></video>
    </a-assets>

    <a-entity camera look-controls>
        <a-entity
           id="title-static"
           geometry="primitive: plane; width: 3; height: 3;"
           material="color: #5f9ea0"
           text="value: Welcome to the Classroom1!"
           position = "1 1 1" staticcontent>
         </a-entity>
     </a-entity>
               
    <a-entity  gltf-model="#co2" position="-5 3 -2" scale="5 5 5 ">
      <a-animation attribute="position" direction="alternate" dur="2000" repeat="indefinite" to="-5.1 2.9 -2.1"></a-animation>
      <a-animation attribute="scale" begin="mouseenter" dur="300" to="5.5 5.5 5.5"></a-animation>
      <a-animation attribute="scale" begin="mouseleave" dur="300" to="5 5 5"></a-animation>
    </a-entity>
    <a-entity  gltf-model="#h2o" position="5 1.8 3" scale="5 5 5 ">
      <a-animation attribute="position" direction="alternate" dur="2000" repeat="indefinite"to="5.1 1.9 3.1"></a-animation>
      <a-animation attribute="scale" begin="mouseenter" dur="300" to="5.5 5.5 5.5"></a-animation>
      <a-animation attribute="scale" begin="mouseleave" dur="300" to="5 5 5"></a-animation>
    </a-entity>
    <a-entity  gltf-model="#solid" position="-4 2.7 6" shadow="castShadow:true" scale="5 5 5 ">
      <a-animation attribute="position" direction="alternate" dur="2000" repeat="indefinite" to="-4.1 2.6 5.9"></a-animation>
      <a-animation attribute="scale" begin="mouseenter" dur="300" to="5.5 5.5 5.5"></a-animation>
      <a-animation attribute="scale" begin="mouseleave" dur="300" to="5 5 5"></a-animation>
    </a-entity>
    <a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" camera position="0 1.3 0" spawn-in-circle="radius:3;" wasd-controls look-controls>
    </a-entity>
    <a-sky color="#ECECEC"></a-sky>
    <a-entity id='cameraWrapper' position="0 0 0">
        <a-camera wasd-controls-enabled="true" position="0 2 0" look-controls>
          <a-text  id="subtitle" position="-3.5 -1.7 -2.5" value="Hello" color="#fff"></a-text>
          <a-cursor></a-cursor>
        </a-camera>
    </a-entity>
    <a-video src="#v" width="7" height="5.25" position="2 3 -5" listener></a-video>
    <a-sound src="src: url(../img/sample1.wav)" autoplay="true" position="0 2 5"></a-sound>
    <a-entity gltf-model=#tree1 position="16.206 4.883 -13.282" scale="19 19 19"></a-entity>
     <!-- <a-entity gltf-model=#tree2 position="2.054 5.944 -30.888" scale="15 15 15"></a-entity>
     <a-entity gltf-model=#tree3 position="-22.328 3.734 -14.083" scale="20 20 20"></a-entity>
     <a-entity gltf-model=#tree4 position="10.506 4.737 -27.345" scale="21 21 21"></a-entity>
     <a-entity gltf-model=#tree5 position="8.119 2.292 -28.408" scale="12 12 12"></a-entity>
     <a-entity gltf-model=#tree6 position="-2.525 4.198 -21.702" scale="18 18 18"></a-entity>
     <a-entity gltf-model=#tree7 position="-17.019 2.901 -10.016" scale="12 12 12"></a-entity>
     <a-entity gltf-model=#tree8 position="-16.033 5.149 -30.957" scale="23 23 23"></a-entity>
     <a-entity gltf-model=#tree9 position="-9.289 6.487 -25.839" scale="25 25 25"></a-entity>
     <a-entity gltf-model=#tree10 position="-16.385 3.138 -18.115" scale="15 15 15"></a-entity> -->
  </a-scene>
  <script>
    AFRAME.registerComponent('staticcontent', {
      tick: function () {
        var el = this.el;
        el.setAttribute("text", {value: 'Welcome to SU Virtual Classroom ', align: 'center'});
      }
    });

    var sceneEl = document.querySelector('a-scene');
    var presenterEl = sceneEl.querySelector('#player');
    presenterEl.addEventListener('componentchanged', (evt) => {
      if (evt.detail.name === 'position' || evt.detail.name === 'rotation') {
          data = {
              position: evt.target.getAttribute('position'),
              rotation: evt.target.getAttribute('rotation')
          };
          console.log('Entity has moved to', data, '!');
          // console.log(evt.target.getAttribute('position'))
          NAF.connection.broadcastData("presenter", data)
      }
    });

    // Make a request for a user with a given ID
    axios.get('/api')
      .then((response) => {
        // handle success
        console.log(response);
        var sceneEl = document.querySelector('a-scene');
        var subtitle = sceneEl.querySelector('#subtitle');
        subtitle.setAttribute('value', response.data);
      })
      .catch((error) => {
        // handle error
        console.log(error);
      })
      .then(() => {
        // always executed
      });
  </script>
  </body>
</html>